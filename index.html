<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basecamp Calculator & Treasure Hunt Clues</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #121212;
      color: #f0f0f0;
    }
    select, button, input, textarea {
      margin: 5px 0;
      font-size: 16px;
      padding: 5px 8px;
      background-color: #1f1f1f;
      color: #f0f0f0;
      border: 1px solid #333;
      border-radius: 4px;
    }
    button:hover, select:hover, input:hover, textarea:hover {
      border-color: #555;
    }
    h1 {
      font-size: 28px;
    }
    h2 {
      margin-top: 24px;
      font-size: 22px;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      margin-bottom: 6px;
    }
    .menu-container {
      margin-top: 20px;
      border: 1px solid #333;
      padding: 12px;
      background-color: #1b1b1b;
      border-radius: 6px;
    }
    #menuResults ul, #treasureResults ul {
      background-color: #1f1f1f;
      padding: 10px;
      border-radius: 6px;
    }
    #menuResults li, #treasureResults li {
      padding: 3px 0;
    }
    #treasureSearch {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      background-color: #1f1f1f;
      color: #f0f0f0;
      border: 1px solid #333;
      border-radius: 4px;
    }
    .two-col { display: flex; gap: 12px; flex-wrap:wrap; }
    .col { flex: 1 1 300px; min-width:260px; }
    .small { width:120px; display:inline-block; margin-right:8px; vertical-align:middle;}
    .results-box { background:#0f0f0f; padding:10px; border-radius:6px; margin-top:10px; }
    .label { display:block; margin-top:8px; font-size:14px; color:#ccc; }
    table { width:100%; border-collapse:collapse; margin-top:8px;}
    td, th { padding:6px; border-bottom:1px solid #222; text-align:left;}
  </style>
</head>
<body>

  <h1>Interactive Game Calculators / Treasure Hunt</h1>

  <label for="menuSelect">Select Calculator / Menu:</label>
  <select id="menuSelect"></select>

  <div id="menuContainer" class="menu-container"></div>

<script>
// =================== FULL DATASET (Levels 1–75) — updated from BaseTower.java ===================
const basecampData = {
  1:  { required: { "Coins":10000, "Wood":200, "Thread":500 }, rewards: { "Small Exp Scroll":1 } },
  2:  { required: { "Coins":20000, "Hide":500, "Iron":250 }, rewards: { "Small Exp Scroll":1 } },
  3:  { required: { "Coins":30000, "Yarn":250, "Barrel":200 }, rewards: { "Small Exp Scroll":1 } },
  4:  { required: { "Coins":40000, "Attack Potion":200, "Waterskin":100 }, rewards: { "Small Exp Scroll":1 } },
  5:  { required: { "Coins":50000, "Gold Coin":15, "Thread":1000 }, rewards: { "Small Exp Scroll":1 } },
  6:  { required: { "Coins":60000, "Strength Potion":250, "Coin Purse":100 }, rewards: { "Small Exp Scroll":2 } },
  7:  { required: { "Coins":70000, "Perch":250, "Raw Perch":250 }, rewards: { "Small Exp Scroll":2 } },
  8:  { required: { "Coins":80000, "Red Onion":100, "Strawberry":100 }, rewards: { "Small Exp Scroll":2 } },
  9:  { required: { "Coins":90000, "Steel Bar":200, "Wood":300 }, rewards: { "Small Exp Scroll":2 } },
 10:  { required: { "Coins":100000, "Gold Coin":30, "Energy Potion":300 }, rewards: { "Small Exp Scroll":2 } },
 11:  { required: { "Coins":200000, "Super Defence Potion":200, "Hammer":100 }, rewards: { "Medium Exp Scroll":1 } },
 12:  { required: { "Coins":300000, "Crab":500, "Raw Crab":500 }, rewards: { "Medium Exp Scroll":1 } },
 13:  { required: { "Coins":400000, "Lemon":250, "Red Onion":250 }, rewards: { "Medium Exp Scroll":1 } },
 14:  { required: { "Coins":500000, "Clownfish":500, "Raw Clownfish":500 }, rewards: { "Medium Exp Scroll":1 } },
 15:  { required: { "Coins":1000000, "Gold Coin":45, "Yarn":2000 }, rewards: { "Medium Exp Scroll":1 } },
 16:  { required: { "Coins":1500000, "Super Defence Potion":500, "Raft":200 }, rewards: { "Medium Exp Scroll":2 } },
 17:  { required: { "Coins":2000000, "Diary":100, "Notebook":100 }, rewards: { "Medium Exp Scroll":2 } },
 18:  { required: { "Coins":2500000, "Anchor":100, "Fish Hook":200 }, rewards: { "Medium Exp Scroll":2 } },
 19:  { required: { "Coins":3000000, "Jellyfish":200, "Super Forestry Potion":100 }, rewards: { "Medium Exp Scroll":2 } },
 20:  { required: { "Coins":5000000, "Gold Coin":60, "Mithril Bar":500 }, rewards: { "Medium Exp Scroll":2 } },
 21:  { required: { "Coins":6000000, "Super Strength Potion":500, "Super Defence Potion":500 }, rewards: { "Large Exp Scroll":1 } },
 22:  { required: { "Coins":7000000, "Pufferfish":500, "Raw Pufferfish":500 }, rewards: { "Large Exp Scroll":1 } },
 23:  { required: { "Coins":8000000, "Extreme Energy Potion":300, "Crate":250 }, rewards: { "Large Exp Scroll":1 } },
 24:  { required: { "Coins":9000000, "Workbench":250, "Rope":1000 }, rewards: { "Large Exp Scroll":1 } },
 25:  { required: { "Coins":10000000, "Gold Coin":75, "Dragon Leather":500 }, rewards: { "Large Exp Scroll":1 } },
 26:  { required: { "Coins":15000000, "Extreme Attack Potion":750, "Extreme Defence Potion":750 }, rewards: { "Large Exp Scroll":2 } },
 27:  { required: { "Coins":20000000, "Extreme Defence Potion":750, "Mithril Top":200 }, rewards: { "Large Exp Scroll":2 } },
 28:  { required: { "Coins":25000000, "Extreme Strength Potion":500, "Mithril Axe":250 }, rewards: { "Large Exp Scroll":3 } },
 29:  { required: { "Coins":30000000, "Bestiary":500, "Extreme Forestry Potion":250 }, rewards: { "Large Exp Scroll":4 } },
 30:  { required: { "Coins":100000000, "Gold Coin":100, "Extreme Strength Potion":500 }, rewards: { "Large Exp Scroll":5 } },
 31:  { required: { "Coins":120000000, "Blue Shrimp":5000, "Blue Crab":5000 }, rewards: { "Large Exp Scroll":6 } },
 32:  { required: { "Coins":140000000, "Coin Purse":1000 }, rewards: { "Large Exp Scroll":7 } },
 33:  { required: { "Coins":160000000, "Extreme Energy Potion":2000 }, rewards: { "Large Exp Scroll":8 } },
 34:  { required: { "Coins":180000000, "Lightning Potion":1000, "Dragon Rider Greaves":1000 }, rewards: { "Large Exp Scroll":9 } },
 35:  { required: { "Coins":200000000, "Blueberry":10000, "Cedar Log":2500 }, rewards: { "Large Exp Scroll":10 } },
 36:  { required: { "Coins":220000000, "Super Power Stone":5, "Elder Log":5000 }, rewards: { "Queens Armour Fragment":10 } },
 37:  { required: { "Coins":240000000, "Crystal Chest":2000, "Crystal Key":2000 }, rewards: { "Queens Armour Fragment":10 } },
 38:  { required: { "Coins":260000000, "Blue Thread":25000, "Redwood Log":5000 }, rewards: { "Queens Armour Fragment":10 } },
 39:  { required: { "Coins":280000000, "Golden Necklace":500, "Fish Soup":2500 }, rewards: { "Queens Armour Fragment":10 } },
 40:  { required: { "Coins":300000000, "Gold Coin":150, "Ember Fern":5000 }, rewards: { "Queens Armour Fragment":10 } },
 41:  { required: { "Coins":350000000, "Sunburst Flower":10000, "Fish Steak":2500 }, rewards: { "Queens Weapon Fragment":5 } },
 42:  { required: { "Coins":400000000, "Rock Skin Potion":500, "Bone Stew":3000 }, rewards: { "Queens Weapon Fragment":10 } },
 43:  { required: { "Coins":450000000, "Liquid Death Potion":500, "Thieving Potion":2500 }, rewards: { "Queens Weapon Fragment":15 } },
 44:  { required: { "Coins":500000000, "Mahogany Log":5000, "Cherry Blossom Log":5000 }, rewards: { "Queens Weapon Fragment":20 } },
 45:  { required: { "Coins":550000000, "Gold Coin":200, "Coin Purse":10000 }, rewards: { "Queens Weapon Fragment":25 } },
 46:  { required: { "Coins":600000000, "Mushroom Soup":5000, "Mahogany Log":7500 }, rewards: { "Kings Weapon Fragment":2 } },
 47:  { required: { "Coins":650000000, "Ultimate Power Potion":2500, "Extreme Power Potion":4000 }, rewards: { "Kings Weapon Fragment":5 } },
 48:  { required: { "Coins":700000000, "Dragon Skull":1000, "Dragon Tail":1000 }, rewards: { "Kings Weapon Fragment":10 } },
 49:  { required: { "Coins":750000000, "Coin Purse":10000, "Crab Soup":10000 }, rewards: { "Kings Weapon Fragment":25 } },
 50:  { required: { "Coins":1000000000, "Invincibility Potion":2500, "Golden Touch Potion":2500 }, rewards: { "Kings Weapon Fragment":50 } },
 51:  { required: { "Coins":1100000000, "Gold Coin":10000, "Ring Fragments":500 }, rewards: { "Challenge Coins":20 } },
 52:  { required: { "Coins":1200000000, "Necromancer Top":50, "Necromancer Greaves":50 }, rewards: { "Enhancement Ticket":5 } },
 53:  { required: { "Coins":1300000000, "Mystic Robe":25, "Mystic Bottoms":25 }, rewards: { "Soul Gem":50 } },
 54:  { required: { "Coins":1400000000, "Scythe of Demeter":10, "Restoration Fragment 4":10 }, rewards: { "Casket of Treasure":100 } },
 55:  { required: { "Coins":1500000000, "Gold Coin":25000, "Ancient Elven Book":5 }, rewards: { "Challenge Coins":20 } },
 56:  { required: { "Coins":1600000000, "Challenger Boots":2, "Challenger Gloves":2 }, rewards: { "Enhancement Ticket":5 } },
 57:  { required: { "Coins":1700000000, "Drakes Diary":15, "Elven Grace Potion":15000 }, rewards: { "Massive Exp Scroll":1 } },
 58:  { required: { "Coins":1800000000, "Ring Fragments":1000, "Barbarian Top":50 }, rewards: { "Casket of Treasure":100 } },
 59:  { required: { "Coins":1900000000, "Challenger Hat":2, "Burnt Lobster":10000 }, rewards: { "Elven Weapon Fragment":100 } },
 60:  { required: { "Coins":2000000000, "Gold Coin":100000, "Eternal Ring":5 }, rewards: { "Challenge Coins":20 } },
 61:  { required: { "Coins":2000000000, "Large Exp Scroll":250, "Necklace of Health":10 }, rewards: { "Enhancement Ticket":5 } },
 62:  { required: { "Coins":2000000000, "Challenger Legs":2, "Challenger Top":2 }, rewards: { "Soul Gem":50 } },
 63:  { required: { "Coins":2000000000, "Ring Fragments":2000, "Ring of Renewal":25 }, rewards: { "Elven Weapon Fragment":100 } },
 64:  { required: { "Coins":2000000000, "Primal Gloves":2, "Primal Boots":2 }, rewards: { "Massive Exp Scroll":1 } },
 65:  { required: { "Coins":2000000000, "Gold Coin":500000, "Chefs Hat":5 }, rewards: { "Casket of Treasure":250 } },
 66:  { required: { "Coins":2000000000, "Primal Legs":2, "Primal Top":2 }, rewards: { "Elven Armour Fragment":500 } },
 67:  { required: { "Coins":2000000000, "Ring of Life":20, "Ring of Death":20 }, rewards: { "Elven Weapon Fragment":100 } },
 68:  { required: { "Coins":2000000000, "Ring Fragments":2500, "Wooden Stick":5 }, rewards: { "Soul Gem":50 } },
 69:  { required: { "Coins":2000000000, "Blessed Eternal Sacrifice":5, "Goblin Cleaver":50 }, rewards: { "Massive Exp Scroll":5 } },
 70:  { required: { "Coins":2000000000, "Gold Coin":1000000, "Cognium Ring":2 }, rewards: { "Casket of Treasure":250 } },
 71:  { required: { "Coins":2000000000, "Necklace of Amaran":1, "Mystic Staff (E)":1 }, rewards: { "Elven Weapon Fragment":500 } },
 72:  { required: { "Coins":2000000000, "Hatchet of the Gods":10, "Rabbits Foot":25 }, rewards: { "Soul Gem":100 } },
 73:  { required: { "Coins":2000000000, "Burnt Shrimp":25000, "Burnt Snail":25000 }, rewards: { "Massive Exp Scroll":5 } },
 74:  { required: { "Coins":2000000000, "Ring Fragments":5000, "Ring of Souls (E)":1 }, rewards: { "Casket of Treasure":1000 } },
 75:  { required: { "Coins":2000000000, "Gold Coin":5000000, "Eternal Berserker Ring":10 }, rewards: { "Casket of Treasure":5000 } }
};

// =================== TREASURE HUNT DATA ===================
const treasureHuntData = [
  { clue: "A bustling waterway amidst stone and steel, where the flow never sleeps.", skill: "Fishing", task: "City River" },
  { clue: "A great place to find a Ferris Wheel, or an Arcade. Omg Donuts and Slush!", skill: "Fishing", task: "Beach Pier" },
  { clue: "A hidden paradise among trees, where the waters reflect the canopy above.", skill: "Fishing", task: "The Grove" },
  { clue: "A peaceful place filled with birds chirping, the beating heart of the earth", skill: "Fishing", task: "Woodland Lake" },
  { clue: "As strong as they come, very reliable", skill: "Forestry", task: "Oak Tree" },
  { clue: "Can't beat a good old Bacon Butty!", skill: "Combat", task: "Pig" },
  { clue: "Can't touch this", skill: "Alchemy", task: "Invincibility Potion" },
  { clue: "Contains information about things, well, technically this one doesn't, but usually they do", skill: "Crafting", task: "Bestiary" },
  { clue: "Did I get this one right? It is blue, right?", skill: "Combat", task: "Baby Blue Dragon" },
  { clue: "Do these even work? Well, only one way to find out", skill: "Alchemy", task: "Luck Potion" },
  { clue: "Do we really know more about space?", skill: "Fishing", task: "Open Ocean" },
  { clue: "Don't hit me on the head", skill: "Crafting", task: "Nails" },
  { clue: "Don't touch the but!", skill: "Cooking", task: "Clownfish" },
  { clue: "Evergreen Tree, often red in colour", skill: "Forestry", task: "Cedar Tree" },
  { clue: "Fair enough, I'm partially colourblind, so yes, I got this one a little off.", skill: "Combat", task: "Green Dragon" },
  { clue: "For Cognium!", skill: "Combat", task: "Crocodile" },
  { clue: "Give a man a fish, feed him for a day. Teach a man to fish, feed him for a lifetime.", skill: "Crafting", task: "Fishing Net" },
  { clue: "He can help me practice my bow skills, or just show off with his.", skill: "Combat", task: "Elven Archer" },
  { clue: "How did I even catch this?", skill: "Cooking", task: "Octopus" },
  { clue: "How on earth did a trolley get in there?", skill: "Fishing", task: "Small Pond" },
  { clue: "How on earth does this not make me rich behind my wildest dreams", skill: "Mining", task: "Gold Ore" },
  { clue: "I aint eating that, looks like it's still on fire!", skill: "Cooking", task: "Dragon Platter" },
  { clue: "I am found in all kinds of plants and animals across the earth and used as a defence mechanism", skill: "Alchemy", task: "Poison Potion" },
  { clue: "I am found in the darkness and have many eyes", skill: "Combat", task: "Giant Cave Spider" },
  { clue: "I am the King of the greatly feared creatures, fire is my breath", skill: "Combat", task: "King Dragon" },
  { clue: "I am the Queen of a newly discovered realm", skill: "Combat", task: "Elven Queen" },
  { clue: "I come in many types, King is my most well known", skill: "Combat", task: "Cobra" },
  { clue: "I could make some syrup, well, not on this game, but maybe one day?", skill: "Forestry", task: "Maple Tree" },
  { clue: "I feel harsh pickpocketing him, but I need money too you know!", skill: "Thieving", task: "Bard" },
  { clue: "I gotta go, we got cows", skill: "Alchemy", task: "Cyclone Potion" },
  { clue: "I lead an ancient forgotten tribe", skill: "Combat", task: "Ancient Tribal Leader" },
  { clue: "I must be aware of all the needles", skill: "Forestry", task: "Pine Tree" },
  { clue: "I prefer nice dreams", skill: "Combat", task: "Nightmare" },
  { clue: "I shall rise from the ashes and become reborn", skill: "Combat", task: "Phoenix" },
  { clue: "I think we have a slight problem, that my friend is what we call a lot of snow!", skill: "Alchemy", task: "Avalanche Potion" },
  { clue: "I wonder if that's where the name comes from?", skill: "Forestry", task: "Cherry Blossom Tree" },
  { clue: "I would not recommend giving this guy a cuddle.", skill: "Combat", task: "Fluffy" },
  { clue: "I’m smart so I wish people would acknowledge that", skill: "Combat", task: "Dummy Queen" },
  { clue: "If I get caught, he better not give me a job to do", skill: "Thieving", task: "Taskmaster" },
  { clue: "I'm gonna take this night, and make it…", skill: "Forestry", task: "Evergreen Tree" },
  { clue: "I'm sorry, but I'm on Team Egg", skill: "Combat", task: "Chicken" },
  { clue: "In the clouds. I'm the king of the world!", skill: "Discovery", task: "Rocky Peaks" },
  { clue: "Is this even edible?", skill: "Cooking", task: "Bone Stew" },
  { clue: "It’s not real, I mean, if it was it would be cool though right?", skill: "Mining", task: "Dragon Ore" },
  { clue: "Karen, activate insta kill!", skill: "Alchemy", task: "Liquid Death Potion" },
  { clue: "Named after a place near where I grew up. Quite a few things are actually.", skill: "Fishing", task: "Livingstone Island" },
  { clue: "Not very comfortable to lie on", skill: "Combat", task: "Lion" },
  { clue: "Now I know how Midas felt", skill: "Alchemy", task: "Golden Touch Potion" },
  { clue: "On a diet? Nope, but this makes for some good healing", skill: "Cooking", task: "Fruit Salad" },
  { clue: "Poor Cow", skill: "Crafting", task: "Leather" },
  { clue: "Seriously though, who comes up with these names?", skill: "Discovery", task: "Mount Kwaya" },
  { clue: "Some people say I'm your best friend. Others just see money.", skill: "Mining", task: "Diamond" },
  { clue: "Think of the amount of Fish I can catch with this beast!", skill: "Crafting", task: "Large Fishing Net" },
  { clue: "This tree is a living fossil and has fan shaped leaves.", skill: "Forestry", task: "Ginkgo Tree" },
  { clue: "Up in the clouds. I'm the king of the World!", skill: "Discovery", task: "Rocky Peaks" },
  { clue: "Wana bet? Discovery Lake Wana Wood", skill: "Combat", task: "Training Dummy" },
  { clue: "Wouldn't these be like, really heavy?", skill: "Crafting", task: "Iron Boots" },
  { clue: "Yeah no thanks, I don't like the dark.", skill: "Fishing", task: "Cave" },
  { clue: "You may need to wrap up warm for this one", skill: "Discovery", task: "Frozen Wasteland" }
];

// =================== ALCHEMY POTIONS DATA ===================
const alchemyPotions = [
  { name: "Attack Potion", level: 1, exp: 18, materials: ["Empty Vial","Akomeric","Birds Nest"], amounts: [1,1,1] },
  { name: "Defence Potion", level: 5, exp: 30, materials: ["Empty Vial","Akomeric","Bones"], amounts: [1,1,5] },
  { name: "Strength Potion", level: 10, exp: 45, materials: ["Empty Vial","Akomeric","Mushroom"], amounts: [1,1,5] },
  { name: "Fishing Potion", level: 18, exp: 90, materials: ["Empty Vial","Bloodroot","Fish Hook"], amounts: [1,1,1] },
  { name: "Health Potion", level: 32, exp: 130, materials: ["Empty Vial","Bloodroot","Gold Feather"], amounts: [1,1,5] },
  { name: "Energy Potion", level: 38, exp: 160, materials: ["Empty Vial","Bloodroot","Orange"], amounts: [1,1,5] },
  { name: "Super Attack Potion", level: 40, exp: 200, materials: ["Hyssop","Attack Potion","Pearl"], amounts: [1,1,5] },
  { name: "Super Fishing Potion", level: 45, exp: 240, materials: ["Hyssop","Fishing Potion","Jawbone"], amounts: [1,1,5] },
  { name: "Super Defence Potion", level: 48, exp: 300, materials: ["Safflower","Defence Potion","Blue Feather"], amounts: [1,1,10] },
  { name: "Power Potion", level: 52, exp: 325, materials: ["Attack Potion","Strength Potion","Defence Potion"], amounts: [1,1,10] },
  { name: "Super Energy Potion", level: 57, exp: 350, materials: ["Safflower","Energy Potion","Compass","Lemon"], amounts: [1,1,1,10] },
  { name: "Super Strength Potion", level: 62, exp: 380, materials: ["Safflower","Strength Potion","Mushroom"], amounts: [1,1,5] },
  { name: "Super Health Potion", level: 65, exp: 400, materials: ["Sage Leaf","Health Potion","Ram Skull"], amounts: [1,1,1] },
  { name: "Luck Potion", level: 70, exp: 450, materials: ["Empty Vial","Sage Leaf","Emerald"], amounts: [1,1,1] },
  { name: "Extreme Energy Potion", level: 73, exp: 500, materials: ["Sage Leaf","Super Energy Potion","Treasure Map","Eggplant"], amounts: [1,1,1,10] },
  { name: "Super Power Potion", level: 76, exp: 540, materials: ["Super Attack Potion","Super Strength Potion","Super Defence Potion","Wolfmint"], amounts: [1,1,1,1] },
  { name: "Extreme Attack Potion", level: 78, exp: 625, materials: ["Wolfmint","Super Attack Potion","Marlin"], amounts: [1,1,5] },
  { name: "Poison Potion", level: 80, exp: 660, materials: ["Empty Vial","Wolfmint","Dragon Ore"], amounts: [1,1,2] },
  { name: "Extreme Defence Potion", level: 82, exp: 700, materials: ["Wolfmint","Super Defence Potion","Ray"], amounts: [1,1,5] },
  { name: "Mining Potion", level: 85, exp: 850, materials: ["Empty Vial","Wolfmint","Ruby"], amounts: [1,1,4] },
  { name: "Extreme Strength Potion", level: 90, exp: 1000, materials: ["Wolfmint","Super Strength Potion","Shark"], amounts: [1,1,5] },
  { name: "Extreme Health Potion", level: 94, exp: 1600, materials: ["Vissinel","Super Health Potion","Octopus"], amounts: [1,1,10] },
  { name: "Thieving Potion", level: 96, exp: 1800, materials: ["Empty Vial","Vissinel","Blue Silk"], amounts: [1,1,2] },
  { name: "Extreme Power Potion", level: 99, exp: 2000, materials: ["Extreme Attack Potion","Extreme Strength Potion","Extreme Defence Potion","Sunburst Flower"], amounts: [1,1,1,1] },
  { name: "Insta Kill Potion", level: 101, exp: 2500, materials: ["Empty Vial","Sunburst Flower","Blueprints","Coins"], amounts: [1,1,1,10000] },
  { name: "Lightning Potion", level: 103, exp: 2700, materials: ["Empty Vial","Sunburst Flower","Golden Scarab"], amounts: [1,1,2] },
  { name: "Extreme Luck Potion", level: 106, exp: 3000, materials: ["Sunburst Flower","Luck Potion"], amounts: [3,3] },
  { name: "Rock Skin Potion", level: 109, exp: 3500, materials: ["Empty Vial","Sunburst Flower","Dragon Ore","Dragon Leather","Coins"], amounts: [1,1,5,5,5000] },
  { name: "Liquid Death Potion", level: 114, exp: 4500, materials: ["Sunburst Flower","Insta Kill Potion","Stone Tablet","Coins"], amounts: [2,2,2,30000] },
  { name: "Thunderstorm Potion", level: 121, exp: 5500, materials: ["Empty Vial","Ember Fern","Tooth Necklace"], amounts: [1,1,1] },
  { name: "Cyclone Potion", level: 123, exp: 6500, materials: ["Empty Vial","Ember Fern","Dragon Scimitar"], amounts: [1,1,1] },
  { name: "Elven Grace Potion", level: 124, exp: 7000, materials: ["Elven Crystal","Stone Tablet","Ember Fern","Coins"], amounts: [1,5,3,50000] },
  { name: "Ultimate Power Potion", level: 126, exp: 7500, materials: ["Ember Fern","Extreme Power Potion","Dragon Skull"], amounts: [1,1,1] },
  { name: "Summer Cocktail", level: 127, exp: 7500, materials: ["Liquid Death Potion","Wine","Orange","Lemon","Gold Coin"], amounts: [1,5,3,50000] },
  { name: "Golden Touch Potion", level: 128, exp: 8000, materials: ["Empty Vial","Pirates Hat","Treasure Map","Ember Fern","Coins"], amounts: [1,1,1,1,25000] },
  { name: "Avalanche Potion", level: 129, exp: 9000, materials: ["Elven Crystal","Book of Aroon","Ember Fern","Coins"], amounts: [1,1,3,75000] },
  { name: "Invincibility Potion", level: 130, exp: 10000, materials: ["Rock Skin Potion","Ember Fern","Stone Tablet"], amounts: [1,2,5] },
  { name: "Divine Protection Potion", level: 130, exp: 50000, materials: ["Gold Coin","Elven Armour Fragment","Kings Armour Fragment","Ember Fern"], amounts: [1500,1,1,5] },
  { name: "Soul Reaper Potion", level: 130, exp: 100000, materials: ["Liquid Death Potion","Gold Coin","Dark Thread","Stone Tablet"], amounts: [25,7500,50,50] }
];

// =================== UTILITY FUNCTIONS ===================
function calculateTotals(data, start, end) {
  const required = {};
  const rewards  = {};
  for (let lvl = start; lvl <= end; lvl++) {
    const entry = data[lvl];
    if (!entry) continue;
    for (const [itm, amt] of Object.entries(entry.required || {})) {
      required[itm] = (required[itm] || 0) + amt;
    }
    for (const [itm, amt] of Object.entries(entry.rewards || {})) {
      rewards[itm] = (rewards[itm] || 0) + amt;
    }
  }
  return { required, rewards };
}

// ----------------- Wishing Well calculators (Beginner & Endgame) -----------------
// Constants (derived from DatabaseManager/BaseTower)
const ENDGAME_BIG_WISH_BASE = 15000; // base cost for Endgame (big) wishes
const ENDGAME_BIG_WISH_MAX_TOTAL = 415; // sum of bigWishMaxLevels from DatabaseManager
const BEGINNER_BASE = 3;
const BEGINNER_COST_CAP = 500;
// total beginner wishes required sum (from wishMaxLevels earlier) — derived from DatabaseManager
const BEGINNER_WISH_TOTAL = 1950; // derived from DatabaseManager wishMaxLevels sum

function calculateEndgameFromNextCost(nextCost) {
  nextCost = Math.max(0, Math.floor(nextCost));
  const base = ENDGAME_BIG_WISH_BASE;
  let alreadyMade = 0;
  if (nextCost >= base) {
    alreadyMade = Math.floor(nextCost / base) - 1;
    if (alreadyMade < 0) alreadyMade = 0;
  }
  const remainingWishes = Math.max(0, ENDGAME_BIG_WISH_MAX_TOTAL - alreadyMade);
  const X = remainingWishes;
  const part1 = X * alreadyMade;
  const part2 = (X * (X + 1)) / 2;
  const totalGoldNeeded = base * (part1 + part2);
  return { alreadyMade, remainingWishes, totalGoldNeeded };
}

function calculateBeginnerFromNextCost(nextCost) {
  nextCost = Math.max(0, Math.floor(nextCost));
  const base = BEGINNER_BASE;
  const cap = BEGINNER_COST_CAP;
  let alreadyMade;
  if (nextCost >= cap) {
    alreadyMade = Math.ceil(cap / base) - 1;
  } else {
    alreadyMade = Math.floor(nextCost / base) - 1;
    if (alreadyMade < 0) alreadyMade = 0;
  }
  const remainingWishes = Math.max(0, BEGINNER_WISH_TOTAL - alreadyMade);
  const X = remainingWishes;
  if (X === 0) return { alreadyMade, remainingWishes:0, totalGoldNeeded:0 };
  const k = Math.max(0, Math.min(X, Math.max(0, Math.ceil(cap / base - alreadyMade))));
  const partAP = base * (k * alreadyMade + (k * (k + 1)) / 2);
  const partCap = (X - k) * cap;
  const totalGoldNeeded = Math.floor(partAP + partCap);
  return { alreadyMade, remainingWishes, totalGoldNeeded, capReachedAtTerms: k };
}

function renderBeginnerWishingWell(container) {
  container.innerHTML = `
    <h2>Beginner Wishing Well</h2>
    <p>Enter the current cost the game asks for the next Beginner wish (gold):</p>
    <input id="bw_input" type="number" value="3" min="0" />
    <button id="bw_calc">Calculate</button>
    <div id="bw_result" style="margin-top:10px;"></div>
  `;
  container.querySelector('#bw_calc').addEventListener('click', () => {
    const v = parseInt(container.querySelector('#bw_input').value || 0, 10);
    const res = calculateBeginnerFromNextCost(v);
    const html = [
      `<b>Inferred wishes already made:</b> ${res.alreadyMade.toLocaleString()}`,
      `<b>Wishes remaining to max:</b> ${res.remainingWishes.toLocaleString()}`,
      `<b>Total gold required to complete Beginner Well:</b> ${res.totalGoldNeeded.toLocaleString()}`
    ].join('<br/>');
    container.querySelector('#bw_result').innerHTML = html;
  });
}

function renderEndgameWishingWell(container) {
  container.innerHTML = `
    <h2>Endgame (Big) Wishing Well</h2>
    <p>Enter the current cost the game asks for the next Endgame wish (gold):</p>
    <input id="ew_input" type="number" value="15000" min="0" />
    <button id="ew_calc">Calculate</button>
    <div id="ew_result" style="margin-top:10px;"></div>
  `;
  container.querySelector('#ew_calc').addEventListener('click', () => {
    const v = parseInt(container.querySelector('#ew_input').value || 0, 10);
    const res = calculateEndgameFromNextCost(v);
    const html = [
      `<b>Inferred big wishes already made:</b> ${res.alreadyMade.toLocaleString()}`,
      `<b>Wishes remaining to max (total ${ENDGAME_BIG_WISH_MAX_TOTAL}):</b> ${res.remainingWishes.toLocaleString()}`,
      `<b>Total gold required to complete Endgame Well:</b> ${res.totalGoldNeeded.toLocaleString()}`
    ].join('<br/>');
    container.querySelector('#ew_result').innerHTML = html;
  });
}

// =================== MENUS DEFINITION ===================
const menus = {
  basecamp: {
    name: "Basecamp Calculator (Levels 1–75)",
    render: function(container) {
      container.innerHTML = `
        <div>
          Current Basecamp:
          <select id="basecampStart">${[...Array(75)].map((_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}</select>
          Goal Basecamp:
          <select id="basecampEnd">${[...Array(75)].map((_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}</select>
          <button id="calcBtn">Calculate</button>
        </div>
        <div id="menuResults"></div>
      `;
      // default selections
      container.querySelector('#basecampStart').value = '1';
      container.querySelector('#basecampEnd').value = '75';

      container.querySelector('#calcBtn').addEventListener('click', () => {
        const start = parseInt(container.querySelector('#basecampStart').value, 10);
        const end   = parseInt(container.querySelector('#basecampEnd').value, 10);
        if (isNaN(start) || isNaN(end) || start > end) {
          alert("Please choose valid start and goal levels (start ≤ goal).");
          return;
        }
        const totals = calculateTotals(basecampData, start, end);
        let html = '<h2>Required Items</h2><ul>';
        for (const [item, amt] of Object.entries(totals.required)) {
          html += `<li>${item}: ${amt.toLocaleString()}</li>`;
        }
        html += '</ul><h2>Reward Items</h2><ul>';
        for (const [item, amt] of Object.entries(totals.rewards)) {
          html += `<li>${item}: ${amt.toLocaleString()}</li>`;
        }
        html += '</ul>';
        container.querySelector('#menuResults').innerHTML = html;
      });
    }
  },

  treasureHunt: {
    name: "Treasure Hunt Clues",
    render: function(container) {
      container.innerHTML = `
        <input type="text" id="treasureSearch" placeholder="Search clues or tasks...">
        <div id="treasureResults"></div>
      `;
      const searchInput = container.querySelector("#treasureSearch");
      const resultsDiv = container.querySelector("#treasureResults");

      function renderResults(filter = "") {
        const filtered = treasureHuntData.filter(item =>
          item.clue.toLowerCase().includes(filter) ||
          item.task.toLowerCase().includes(filter) ||
          item.skill.toLowerCase().includes(filter)
        );
        if (filtered.length === 0) {
          resultsDiv.innerHTML = "<p>No matching clues found.</p>";
          return;
        }
        let html = "<ul>";
        filtered.forEach(item => {
          html += `<li><strong>Clue:</strong> ${item.clue}<br><strong>Skill:</strong> ${item.skill} | <strong>Task:</strong> ${item.task}</li>`;
        });
        html += "</ul>";
        resultsDiv.innerHTML = html;
      }

      searchInput.addEventListener("input", () => {
        renderResults(searchInput.value.toLowerCase());
      });

      renderResults();
    }
  },

  alchemyXP: {
    name: "Alchemy XP Calculator",
    render: renderAlchemyXP
  },

  beginnerWell: {
    name: "Beginner Wishing Well",
    render: renderBeginnerWishingWell
  },

  endgameWell: {
    name: "Endgame Wishing Well",
    render: renderEndgameWishingWell
  },

  // ---------------- NEW: Combat Calculator ----------------
  combatCalc: {
    name: "Combat Calculator",
    render: function(container) {
      container.innerHTML = `<div>
        <h2>Combat Calculator</h2>
        <div class="two-col">
          <div class="col">
            <label class="label">Choose Enemy:</label>
            <select id="cc_enemy"></select>

            <label class="label">Fight duration (optional) - Day:Hour:Min:Sec</label>
            <input id="cc_duration" type="text" value="0:0:0:10" placeholder="0:0:0:10">

            <label class="label">Basecamp level (affects combat caps/bonuses):</label>
            <select id="cc_basecamp">${[...Array(75)].map((_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}</select>

            <label class="label">Beginner Wishing Well inferred next-cost (gold) (affects some rewards):</label>
            <input id="cc_bw_cost" type="number" value="3">

            <label class="label">Endgame Wishing Well inferred next-cost (gold):</label>
            <input id="cc_ew_cost" type="number" value="15000">

            <label class="label">Combat boost (%) (e.g. temporary boosts):</label>
            <input id="cc_combat_boost" type="number" value="0" min="0">
          </div>

          <div class="col">
            <label class="label">Player skill levels</label>
            <div><span class="small">Attack</span><input id="cc_level_attack" type="number" value="99" min="1"></div>
            <div><span class="small">Strength</span><input id="cc_level_strength" type="number" value="99" min="1"></div>
            <div><span class="small">Archery</span><input id="cc_level_archery" type="number" value="99" min="1"></div>

            <label class="label">Choose equipment (items are loaded from items.json)</label>
            <div><label>Helm:</label><select id="cc_helm"></select></div>
            <div><label>Top:</label><select id="cc_top"></select></div>
            <div><label>Pants / Legs:</label><select id="cc_legs"></select></div>
            <div><label>Boots:</label><select id="cc_boots"></select></div>
            <div><label>Weapon:</label><select id="cc_weapon"></select></div>
            <div><label>Shield:</label><select id="cc_shield"></select></div>
            <div><label>Ring:</label><select id="cc_ring"></select></div>
            <div><label>Cape:</label><select id="cc_cape"></select></div>
            <div><label>Necklace:</label><select id="cc_neck"></select></div>
            <div><label>Pet:</label><select id="cc_pet"></select></div>

            <label class="label">Optional: Slayer Task (enter monster name exactly or leave blank)</label>
            <input id="cc_slayer_task" type="text" placeholder="e.g. Elven Archer">
          </div>
        </div>

        <div style="margin-top:12px;">
          <button id="cc_calculate">Calculate Combat Results</button>
        </div>

        <div id="cc_results" class="results-box"></div>
      </div>`;

      // Preload enemy dataset (extracted from CombatManager.java)
      // Arrays below are taken from the provided CombatManager.java (enemyNames, enemyHealth, enemyAttack, enemyStrength, enemyDefence, enemyDrops)
      const enemyNames = [ "Chicken","Crow","Rat","Sheep","Goat","Pig","Ox","Young Goblin","Goblin Grump","Goblin Guard","Goblin Chief","Jin","Red Ghoul","Grey Wolf","Cyclops","Cave Demon","Banshee","Cave Beast","Giant Cave Spider","Wild Dog","Crocodile","Lion","Brown Bear","Skeletal Bear","Baby Red Dragon","Baby Blue Dragon","Undead Dragon","Ancient Dragon","Green Dragon","Water Dragon","King Dragon","Dragon Queen","Elite Chicken","Elite Crow","Elite Rat","Elite Sheep","Elite Goat","Elite Pig","Elite Ox","Training Dummy","Ghost","Phoenix","Nightmare","Orc Captain","Cobra","Skeletal Hound","Necromancer","Fluffy","Blue Devil","Ancient Tribal Leader","Dummy Queen","Scarab Queen","Spider Queen","Undead Dragon Queen","Bone King","Skeletal King","Living Armour King","Orc King","Elven Fairy","Elven Warrior","Elven Archer","Elven Mage","Elven King","Elven Queen","Amaran","Aurial","Cognium","Copina","Feroxi","Kynosian","Noctyra","Opulina","Practice Dummy","Spider Clone","Dragon Queen Clone","Tribal Leader Clone","Orc King Clone","Elven Queen Clone","Zombie","Shadow Creature","Shadow Dragon" ];

      const enemyHealth = [ 10,20,30,50,75,100,150,35,75,135,225,375,600,90,150,300,450,675,1000,180,360,570,750,1200,800,1000,1600,2800,4000,5200,8000,15000,10000,15000,20000,25000,30000,50000,75000,35,75,250,400,600,750,1500,2500,5000,8000,12000,50000,75000,100000,150000,200000,250000,300000,400000,100000,150000,300000,400000,600000,750000,7000000,4000000,6000000,5000000,6500000,5000000,6000000,4500000,1,6000000,7000000,8000000,9000000,10000000,12000000,15000000,20000000 ];

      const enemyAttack = [1,5,5,10,10,15,25,10,15,25,45,70,80,35,60,75,75,80,90,50,65,70,80,95,120,150,180,250,300,350,400,800,300,500,400,600,750,900,1200,10,30,50,60,70,80,140,200,250,350,600,2000,2400,3000,3750,5000,7500,10000,15000,8000,9000,12000,15000,24000,30000,70000,60000,80000,60000,90000,80000,100000,70000,1,120000,150000,180000,230000,260000,300000,350000,400000 ];

      const enemyStrength = [1,4,10,15,25,15,30,15,15,20,60,65,90,50,75,65,80,80,95,65,70,75,90,120,120,150,220,280,350,350,450,750,300,400,450,600,750,900,1200,10,25,60,70,80,90,160,250,300,500,800,800,1400,2000,2400,3600,4800,6000,7200,6000,8000,10000,15000,25000,40000,300000,225000,450000,225000,562500,525000,562500,262500,1,600000,800000,1000000,1200000,1400000,1800000,2000000,2500000 ];

      const enemyDefence = [1,5,8,15,15,25,40,5,10,35,50,70,85,40,70,60,70,80,85,55,50,60,85,100,120,130,140,300,240,300,450,2000,200,300,200,400,600,750,1000,10,20,50,75,75,85,120,200,350,400,850,850,1000,1500,1700,2500,3800,5000,8500,10000,12000,14000,16000,18000,25000,67500,36000,54000,40500,63000,36000,67500,45000,1,300000,360000,450000,540000,630000,750000,900000,1200000 ];

      const enemyDrops = [
        "Bones,1,1,Always/Feathers,1,3,Always/Egg,1,1,Uncommon/Drumstick,1,1,Rare/Thread,1,1,Common/Birds Nest,1,1,Uncommon/Common Key,1,1,Rare/Chicken Knife,1,1,Secret Rare",
        "Bones,1,1,Always/Feathers,3,6,Always/Evergreen Arrow Shafts,5,10,Uncommon/Egg,1,1,Uncommon/Thread,1,3,Common/Coins,2,10,Uncommon/Birds Nest,1,2,Uncommon/Common Chest,1,1,Rare/Raw Shrimp,1,1,Uncommon",
        "Bones,1,1,Always/Coins,1,5,Uncommon/Stone Arrowheads,5,10,Uncommon/Common Chest,1,1,Rare/Thread,2,5,Common/Raw Shrimp,1,1,Uncommon/Emerald,1,1,Super Rare",
        "Bones,1,1,Always/Coins,5,10,Uncommon/Wool,1,1,Common/Akomeric,1,1,Rare/Common Chest,1,1,Rare/Thread,2,6,Common/Raw Snail,1,1,Uncommon/Raw Shrimp,1,1,Common",
        "Bones,1,1,Always/Milk,1,1,Uncommon/Oak Arrow Shafts,15,30,Rare/Coins,5,10,Uncommon/Common Chest,1,1,Rare/Thread,5,10,Common/Raw Carp,1,1,Uncommon",
        "Bones,1,1,Always/Bacon,1,1,Common/Coins,10,20,Uncommon/Common Chest,1,1,Rare/Raw Minnows,1,1,Uncommon/Emerald,1,1,Super Rare",
        "Bones,1,1,Always/Milk,1,1,Common/Coins,20,40,Common/Hide,1,1,Common/Common Chest,1,1,Uncommon/Thread,10,15,Common/Raw Perch,1,1,Uncommon",
        "Bones,1,1,Always/Coins,5,10,Common/Evergreen Bow,1,1,Rare/Akomeric,1,1,Uncommon/Bloodroot,1,1,Rare/Hyssop,1,1,Rare/Red Chest,1,1,Super Rare/Oak,1,3,Common",
        // (many more entries exist in original source; this dataset is used to estimate drops)
      ];

      // container elements
      const enemySelect = container.querySelector('#cc_enemy');
      const btnCalc = container.querySelector('#cc_calculate');
      const resultsDiv = container.querySelector('#cc_results');

      // populate enemy dropdown
      enemyNames.forEach((n,i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${n} (HP: ${enemyHealth[i] || '?'})`;
        enemySelect.appendChild(opt);
      });

      // load items.json and populate equipment selects
      let items = [];
      fetch('items.json').then(r => {
        if (!r.ok) throw new Error('items.json not found');
        return r.json();
      }).then(data => {
        items = data;
        populateEquipmentSelectors(items);
      }).catch(err => {
        // fallback empty lists if items.json not available
        console.warn('Could not load items.json:', err);
        items = [];
        populateEquipmentSelectors(items);
      });

      function populateEquipmentSelectors(itemsList) {
        function addOptions(selectEl, filterFn) {
          selectEl.innerHTML = '<option value="">(none)</option>';
          itemsList.filter(filterFn).forEach(it => {
            const opt = document.createElement('option');
            opt.value = it.name;
            opt.textContent = `${it.name} ${it.attack?`(atk ${it.attack})`:''}${it.strength?` (str ${it.strength})`:''}${it.defence?` (def ${it.defence})`:''}`;
            selectEl.appendChild(opt);
          });
        }
        addOptions(container.querySelector('#cc_helm'), it => /Helm/i.test(it.type) || /Helm/i.test(it.name));
        addOptions(container.querySelector('#cc_top'), it => /Top/i.test(it.type) || /Top/i.test(it.name) || /Robe Top/i.test(it.type));
        addOptions(container.querySelector('#cc_legs'), it => /Legs|Greaves|Bottoms|Leggings/i.test(it.type) || /Legs|Greaves/i.test(it.name));
        addOptions(container.querySelector('#cc_boots'), it => /Boots/i.test(it.type) || /Boots/i.test(it.name));
        addOptions(container.querySelector('#cc_weapon'), it => /Weapon/i.test(it.type) || /Sword|Axe|Scimitar|Bow|Staff|Dagger|Scythe/i.test(it.name));
        addOptions(container.querySelector('#cc_shield'), it => /Shield|Defence/i.test(it.name) || /Shield/i.test(it.type));
        addOptions(container.querySelector('#cc_ring'), it => /Ring/i.test(it.name) || /Ring/i.test(it.type));
        addOptions(container.querySelector('#cc_cape'), it => /Cape/i.test(it.type) || /Cape/i.test(it.name));
        addOptions(container.querySelector('#cc_neck'), it => /Necklace/i.test(it.name) || /Necklace/i.test(it.type));
        addOptions(container.querySelector('#cc_pet'), it => /Pet|Avatar|Ace|Saul|Troll|Adam|Saul|Carrie/i.test(it.name) || /Mystery/i.test(it.type));
      }

      // utility to get item by name
      function findItem(name) {
        if (!name) return null;
        return items.find(i => i.name === name) || null;
      }

      // parse duration "D:H:M:S" to milliseconds
      function parseDuration(msStr) {
        const parts = msStr.split(':').map(p => parseInt(p||'0',10));
        if (parts.length === 4) {
          const [d,h,m,s] = parts;
          return (((((d*24)+h)*60)+m)*60+s) * 1000;
        }
        // fallback: try seconds
        const s = parseFloat(msStr);
        return (isNaN(s) ? 0 : s*1000);
      }

      // basic damage formulas (approximation derived from provided Java code patterns)
      // NOTE: The original Android code contains many modifiers. This calculator reproduces a simplified version:
      function calculateMeleeDamage(attackLevel, strengthLevel, attackBonus, strengthBonus, weaponAttack, enemyDef) {
        // attackEffect and strengthEffect are simplified multipliers
        const attackStat = attackLevel + attackBonus;
        const strengthStat = strengthLevel + strengthBonus;

        // Base formula approximation:
        // base = floor( (attackStat * 0.4) + (strengthStat * 0.8) + weaponAttack - enemyDef * 0.2 )
        let base = Math.floor((attackStat * 0.4) + (strengthStat * 0.8) + (weaponAttack || 0) - (enemyDef * 0.2));
        base = Math.max(1, base);
        return base;
      }

      function calculateArcheryDamage(archeryLevel, bowDamage, arrowDamage, bowAccuracy, enemyDef) {
        // approximate: base = bowDamage + arrowDamage + floor(archeryLevel * 0.8) - enemyDef*0.15
        let base = Math.floor((bowDamage || 0) + (arrowDamage || 0) + (archeryLevel * 0.8) - (enemyDef * 0.15));
        base = Math.max(1, base);
        return base;
      }

      // Estimate drop probability mapping based on rarity string in enemyDrops
      const rarityProb = {
        "Always": 1.0,
        "Common": 0.6,
        "Uncommon": 0.3,
        "Rare": 0.07,
        "Super Rare": 0.02,
        "Legendary": 0.005,
        "Secret Rare": 0.001
      };

      // parse an enemy drop string into structured list
      function parseDropString(dropStr) {
        const parts = dropStr.split('/');
        const parsed = [];
        parts.forEach(p => {
          const comps = p.split(',').map(s => s.trim());
          if (comps.length >= 4) {
            const name = comps[0];
            const min = parseInt(comps[1],10) || 1;
            const max = parseInt(comps[2],10) || min;
            const rarity = comps[3];
            parsed.push({ name, min, max, rarity });
          }
        });
        return parsed;
      }

      // compute expected drops per kill using parsed drops + modifiers
      function expectedDropsForKill(parsedDrops, gearModifiers) {
        const expect = {};
        parsedDrops.forEach(d => {
          const prob = rarityProb[d.rarity] || 0.01;
          const avgAmt = (d.min + d.max)/2;
          let adjProb = prob;
          // apply simple gear modifiers: Luck Potion / Ring of Secrets / Treasure boosts / wishes
          if (gearModifiers.hasRingOfSecrets) adjProb *= 1.25;
          if (gearModifiers.hasLuckPotion) adjProb *= 1.15;
          if (gearModifiers.wishTreasureHunterLevels) adjProb *= 1 + gearModifiers.wishTreasureHunterLevels * 0.01;
          // ensure prob capped at 1
          adjProb = Math.min(adjProb, 1);
          expect[d.name] = (expect[d.name] || 0) + adjProb * avgAmt;
        });
        return expect;
      }

      btnCalc.addEventListener('click', () => {
        // collect inputs
        const enemyIdx = parseInt(enemySelect.value,10);
        const enemy = enemyNames[enemyIdx];
        const hp = enemyHealth[enemyIdx] || 0;
        const eDef = enemyDefence[enemyIdx] || 0;
        const durationMs = parseDuration(container.querySelector('#cc_duration').value || '0:0:0:10');
        const basecamp = parseInt(container.querySelector('#cc_basecamp').value,10) || 1;
        const bwCost = parseInt(container.querySelector('#cc_bw_cost').value || 0,10);
        const ewCost = parseInt(container.querySelector('#cc_ew_cost').value || 0,10);
        const combatBoostPct = parseFloat(container.querySelector('#cc_combat_boost').value || 0) || 0;

        const attackLevel = parseInt(container.querySelector('#cc_level_attack').value || 1,10);
        const strengthLevel = parseInt(container.querySelector('#cc_level_strength').value || 1,10);
        const archeryLevel = parseInt(container.querySelector('#cc_level_archery').value || 1,10);

        // equipment
        const equipNames = [
          container.querySelector('#cc_helm').value,
          container.querySelector('#cc_top').value,
          container.querySelector('#cc_legs').value,
          container.querySelector('#cc_boots').value,
          container.querySelector('#cc_weapon').value,
          container.querySelector('#cc_shield').value,
          container.querySelector('#cc_ring').value,
          container.querySelector('#cc_cape').value,
          container.querySelector('#cc_neck').value,
          container.querySelector('#cc_pet').value
        ];

        const equipItems = equipNames.map(n => findItem(n)).filter(Boolean);

        // sum stats
        let atkBonus = 0, strBonus = 0, defBonus = 0, weaponAttack = 0;
        let bowDamage = 0, arrowDamage = 0, bowAccuracy = 50;
        const gearModifiers = {
          hasRingOfSecrets: false,
          hasLuckPotion: false,
          wishTreasureHunterLevels: 0
        };

        equipItems.forEach(it => {
          atkBonus += (it.attack || 0);
          strBonus += (it.strength || 0);
          defBonus += (it.defence || 0);
          weaponAttack += (it.attack && /Weapon/i.test(it.type)) ? it.attack : 0;
          // bow / arrow lookup by name (best-effort)
          if (/Bow/i.test(it.name)) {
            bowDamage += (it.attack || 0);
          }
          if (/Arrow/i.test(it.name)) {
            arrowDamage += (it.attack || 0);
          }
          if (/Ring of Secrets/i.test(it.name)) gearModifiers.hasRingOfSecrets = true;
          if (/Luck Potion/i.test(it.name)) gearModifiers.hasLuckPotion = true;
        });

        // include wishing well levels inference (approx): if user provided next-cost we infer already-made wishes and increase treasure chance
        try {
          const bw = calculateBeginnerFromNextCost(bwCost);
          const ew = calculateEndgameFromNextCost(ewCost);
          // treat beginner wishes as 'Treasure Hunter' effect approx
          gearModifiers.wishTreasureHunterLevels = Math.round((bw.alreadyMade || 0) / 100); // heuristic
          // more Endgame wishes increase rare chances
          gearModifiers.endgameWishes = ew.alreadyMade || 0;
        } catch(e) {
          // ignore
        }

        // compute attack speed (approximation from CombatManager.get Attack Speed patterns)
        // base attack speed (non-bow) approximated as 2000 - attackLevel*5 (see Java code pattern)
        let attackSpeedMs = Math.max(500, 2000 - attackLevel * 5);
        // archery uses BowSpeed if bow equipped - approximate by decreasing by archery level
        const bowEquipped = equipItems.some(it => /Bow/i.test(it.name));
        if (bowEquipped) {
          // Bow speed: approximate from bowQuality: faster bows reduce ms
          attackSpeedMs = Math.max(400, 2000 - Math.floor(archeryLevel * 6));
        }

        // apply basecamp speed bonus (BaseTower had Speed Please wish & basecamp levels influence)
        if (basecamp >= 60) {
          attackSpeedMs = Math.max(200, attackSpeedMs - Math.floor(attackSpeedMs * 0.2)); // 20% faster as in code
        }

        // Apply combat boost percent (temporary)
        const combatBoostMul = 1 + (combatBoostPct / 100);

        // compute damage per hit (avg)
        const meleePerHit = Math.floor(calculateMeleeDamage(attackLevel, strengthLevel, atkBonus, strBonus, weaponAttack, eDef) * combatBoostMul);
        const archeryPerHit = Math.floor(calculateArcheryDamage(archeryLevel, bowDamage, arrowDamage, bowAccuracy, eDef) * combatBoostMul);

        // choose attack style: if weapon is bow, use archery; else melee
        const isArchery = bowEquipped;
        const avgDmg = isArchery ? archeryPerHit : meleePerHit;
        const hitsToKill = Math.max(1, Math.ceil(hp / avgDmg));
        const timeToKillMs = hitsToKill * attackSpeedMs;
        const timeToKillStr = msToDHMS(timeToKillMs);

        // kills possible in given duration
        const killsInDuration = (durationMs > 0) ? Math.floor(durationMs / attackSpeedMs) : 0;

        // parse enemy drops (best-effort)
        const dropsStr = enemyDrops[enemyIdx] || "";
        const parsedDrops = parseDropString(dropsStr);
        const expectedPerKill = expectedDropsForKill(parsedDrops, gearModifiers);

        // scale expected by killsInDuration
        const expectedTotalDrops = {};
        for (const [k,v] of Object.entries(expectedPerKill)) {
          expectedTotalDrops[k] = v * killsInDuration;
        }

        // build results html
        let html = `<h3>Combat Summary vs ${enemy}</h3>`;
        html += `<table><tr><th>Stat</th><th>Value</th></tr>`;
        html += `<tr><td>Enemy HP</td><td>${hp.toLocaleString()}</td></tr>`;
        html += `<tr><td>Estimated damage per hit</td><td>${avgDmg.toLocaleString()} (${isArchery?'Archery':'Melee'})</td></tr>`;
        html += `<tr><td>Attack speed (ms per hit)</td><td>${attackSpeedMs} ms</td></tr>`;
        html += `<tr><td>Hits to kill 1 enemy</td><td>${hitsToKill.toLocaleString()}</td></tr>`;
        html += `<tr><td>Time to kill 1 enemy</td><td>${timeToKillStr} (${timeToKillMs.toLocaleString()} ms)</td></tr>`;
        html += `<tr><td>Planned fight duration</td><td>${msToDHMS(durationMs)} (${durationMs.toLocaleString()} ms)</td></tr>`;
        html += `<tr><td>Estimated kills in duration</td><td>${killsInDuration.toLocaleString()}</td></tr>`;
        html += `</table>`;

        html += `<h4>Expected drops (per kill average)</h4>`;
        html += `<div><table><tr><th>Item</th><th>Per kill (avg)</th><th>Estimated total in planned duration</th></tr>`;
        for (const [itemName, perKill] of Object.entries(expectedPerKill)) {
          html += `<tr><td>${itemName}</td><td>${perKill.toFixed(3)}</td><td>${(expectedTotalDrops[itemName]||0).toFixed(2)}</td></tr>`;
        }
        html += `</table></div>`;

        html += `<h4>Selected Equipment Summary</h4>`;
        html += `<ul>`;
        equipNames.forEach((nm, idx) => {
          if (nm) html += `<li>${["Helm","Top","Legs","Boots","Weapon","Shield","Ring","Cape","Necklace","Pet"][idx]}: ${nm}</li>`;
        });
        html += `</ul>`;

        html += `<div style="margin-top:10px;color:#ccc;font-size:13px;">Note: This calculator reproduces a simplified approximation of the in-game formulas from the provided code. The original game has many conditional modifiers (potions, special equipment sets, event modifiers, etc.) — this tool estimates averages using the items.json stats and enemy data embedded here.</div>`;

        resultsDiv.innerHTML = html;
      });

      // small helper
      function msToDHMS(ms) {
        if (!ms || ms<=0) return '0s';
        let s = Math.floor(ms/1000);
        const d = Math.floor(s / (3600*24)); s -= d*3600*24;
        const h = Math.floor(s/3600); s -= h*3600;
        const m = Math.floor(s/60); s -= m*60;
        return `${d}d ${h}h ${m}m ${s}s`;
      }

    }
  }
};

// =================== INITIALIZATION ===================
const menuSelect = document.getElementById('menuSelect');
const menuContainer = document.getElementById('menuContainer');

// populate menu select
for (const key in menus) {
  const opt = document.createElement('option');
  opt.value = key;
  opt.textContent = menus[key].name;
  menuSelect.appendChild(opt);
}

// Render the first available menu by default
if (menuSelect.options.length > 0) {
  menuSelect.selectedIndex = 0;
  menus[menuSelect.value].render(menuContainer);
}

menuSelect.addEventListener('change', () => {
  menus[menuSelect.value].render(menuContainer);
});

// =================== End of script ===================
</script>

</body>
</html>
